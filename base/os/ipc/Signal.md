---
tags:
  - os/ipc
---
# 信号的概念

信号是一种异步的、非阻塞的通信机制，用于通知接收进程某个事件已经发生。例如，`SIGINT`信号通常由 `Ctrl+C` 触发，用于终止进程。信号（Signal）也叫“用户态中断”，用于异步通知进程某个事件的发生，每个信号都有一个唯一的编号和一个对应的处理动作。当某个信号发生时，内核会向相应的进程发送该信号，并触发预设的信号处理函数或执行默认操作。Linux信号也可以称为软中断，是在软件层次上对中断机制的一种模拟。在原理上，一个进程收到一个信号与处理器收到一个中断请求可以说是一样的。信号通常用于简单的事件通知，如终止进程、暂停执行等，而不适合用于复杂的数据传输任务。信号可以直接进行用户空间进程和内核进程之间的交互，内核进程也可以利用它来通知用户空间进程发生了哪些系统事件。

# 信号的来源

## 硬件来源
- 硬件信号触发：某些硬件操作可能会触发特定的信号。例如，浮点除零操作会触发`SIGFPE`信号。
- 硬件异常：硬件异常，如内存访问越界（段错误，`SIGSEGV`）或非法指令，也会导致信号的产生。

## 软件来源
- **系统调用**：通过系统提供的函数，如 `kill()`、`raise()`、`alarm()`和 `setitimer()` 等，可以显式地向进程发送信号。
- **用户输入**：用户通过终端输入特定的字符组合（如`Ctrl+C`），操作系统会向当前前台进程发送`SIGINT`信号。
- **系统事件**：系统内部发生的事件，如子进程退出，会导致父进程收到`SIGCHLD`信号。
- **定时器**：通过 `alarm()` 或 `setitimer()` 设置的定时器到期时，会向进程发送`SIGALRM`信号。

# 信号的特点

- **简洁性**：信号是一种轻量级的进程间通信方式，不涉及复杂的数据传输。
- **异步性**：信号可以在任何时间发送给进程，不需要进程主动去检查或等待。
- **可配置性**：进程可以指定对信号的处理方式，包括忽略、捕获并自定义处理函数或执行默认操作。

# 实际应用中的使用场景

- **程序终止**：通过发送`SIGTERM`信号来请求进程正常退出，给予进程机会进行资源释放和状态保存。
- **用户交互**：通过发送`SIGINT`信号来中断长时间运行的命令行程序，使用户能够及时终止不必要的操作。
- **守护进程管理**：在服务管理系统中，通过发送不同信号来控制守护进程的启动、停止和重启。
- **错误检测与处理**：利用信号来报告和处理程序运行时遇到的严重错误，如段错误（`SIGSEGV`）。

# 信号分类

在linux系统中，通过 `kill -l` 命令，可以查看所有的信号。

```shell
$ kill -l
HUP INT QUIT ILL TRAP IOT BUS FPE KILL USR1 SEGV USR2 PIPE ALRM TERM STKFLT CHLD CONT STOP TSTP TTIN TTOU URG XCPU XFSZ VTALRM PROF WINCH POLL PWR SYS
```

常见的信号：
- `SIGINT`：终端中断信号，通常由用户输入中断字符（如`Ctrl+C`）产生。
- `SIGKILL`：强制终止信号，无法被捕获或忽略。
- `SIGTERM`：默认的终止信号，进程可以捕获并进行清理工作。
- `SIGCHLD`：子进程终止时，父进程收到的信号。
- `SIGALRM`：定时器信号，由`alarm`函数设置。

# 信号传递和响应

在 Linux 中，信号的传递流程通常遵循以下步骤：

1. **信号产生**：信号可以由内核、操作系统或者应用程序生成。常见的信号产生方式包括用户在终端按下键盘快捷键产生的信号，以及系统调用执行过程中出现的异常情况。
2. **信号传递**：一旦信号被产生，内核会把信号传递给目标进程。目标进程可以是正在等待信号的进程，或者正在执行的进程。如果信号没有被阻塞并且未被忽略，内核将会将信号传递给进程。
3. **信号处理**：一旦进程接收到信号，内核会检查信号的处理方式。根据注册的信号处理方式，可以有以下几种情况：
   - **忽略信号**：即对信号不做任何处理，但是两个信号不能忽略：`SIGKILL`以及`SIGSTOP`。
   - **捕捉信号**：当信号发生时，执行用户自定义的**信号处理函数**。
   - **执行默认操作**：对于大多数信号，操作系统定义了默认的行为。这些默认行为通常是终止进程，生成核心转储文件，或暂停进程执行等。当进程收到信号时，如果没有设置信号的自定义处理函数，将会执行操作系统默认的行为。
4. **信号处理过程**：如果信号的处理方式是执行自定义的信号处理函数，进程将会调用该函数来处理信号。处理函数可以完成一系列操作，比如修改全局变量、执行清理操作等。在信号处理函数执行期间，进程可能会被阻塞在信号处理函数中。
5. **信号返回**：一旦信号处理函数执行完毕，程序将会从信号处理函数中返回，程序恢复执行之前的代码。

注：信号传递不支持排队，当在很短时间内传递多个相同信号，该信号只会被处理一次。

在 Linux 中，信号的传递流程通常是由内核负责进行管理和调度，确保信号被准确传递给目标进程，并按照指定的处理方式进行处理。对于开发人员来说，可以通过信号处理函数来实现对信号的处理和响应，以应对不同的信号产生场景。