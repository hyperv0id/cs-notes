## 分布式系统的挑战

网络传输过程中可能会发生错误，导致程序出错

![image-20231126110320542](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/11/26/image-20231126110320542-13e42e.png)



## 分布式数据复制

- 同步复制：更改后立即发送消息，通知其他节点
- 异步复制：仅在数据库中提交更改后，副本将被修改。

### 复制方案

- 完整的复制
	- 分布式通信网络中的几乎每个位置或用户都可以使用该数据库。
	- 优点:数据可用性高;更快地执行查询。
	- 缺点:并发控制困难;
- 不复制
	- 为没有复制数据库的每个片段只存储在一个位置。
	- 优点:可以优化并发性;数据易于恢复。
	- 缺点:数据可用性低;查询执行缓慢，因为多个客户端访问同一台服务器。
- 部分复制
	- 只复制数据库的一些片段。
	- 优点:副本的数量可以根据某些片段的重要性来控制，这是一个**平衡**的解决方案。


## 分布式事务

定义：并发访问/修改的同步机制

步骤：
- 谈判：要做什么
- 协商：任何一方都可以退出
- 达成协议：作出承诺

eg：![image.png](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/11/26/20231126123809-8ee924.png)

### 事务架构

![image.png](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/11/26/20231126123854-004a4e.png)

eg: ![image.png](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/11/26/20231126124333-249b77.png)

### 事务提交协议

#### 一阶段事务
- 协调器一直请求所有参与者提交，直到他们返回确认。
- 参与者**没有机会**发起中止。

#### 两阶段事务

- 阶段1:征集参与者**投票**。
	1. 协调器发送一个`canCommit`?请求所有参与者。接收时是否可以提交?
	2. 每个参与者回答`是`或`否`。
	3. 如果是，它将事务状态保存到**永久存储**之前发送yes回复。
	4. 如果没有，则立即终止。
- 阶段2:根据投票的输出完成提交或中止。
	1. 如果所有参与者回答yes(包括协调器)，协调器将`doCommit`发送给所有参与者;否则，协调器将`doAbort`发送给投票yes的参与者。
	2. 投赞成票的参与者等待协调器的`doCommit`或`doAbort`，并采取相应的行动。在`doCommit`的情况下，它们发送一个`havecommitted`确认。
- 参与者**可以**发起中止。



## 分布式数据库管理系统

