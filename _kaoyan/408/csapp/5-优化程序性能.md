## 5.1-优化程序性能



- 选择合适的算法和数据结构
- 编译器的能力和局限性
- 处理运算量大的问题时，划分，并行计算



### 优化程序的局限性

```cpp
void add1(long *xp, long* yp){
	*xp += *yp;
	*xp += *yp;
}

void add2(long* xp, long* yp){
	*xp += 2* *yp;
}
```

`add1`和`add2`都是简单的加法运算，你可能会觉得add2更好。

那么能将`add1`**优化**为`add2`吗？

如果`xp`和`yp`指向同一个地址，那么`add1`会翻4倍，但是`add2`会翻3倍。所以不能优化。


同样的，func1不能被优化为func2。因为编译器会假设foo会出现改变常数的情况。＞︿＜

![image-20230613010744235](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/13/image-20230613010744235-35e402.png)



如何表示程序的性能？

```cpp
void psum1(float a[],float p[],long n){
	p[0]=a[0];
	for (long i=1;i<n;i++)
		p[i]=p[i-1]+a[i];
}

// 循环展开
void psum2(float a[],float p[],long n){
	long i 0;
	p[0]=a[0];
	for(i=1;i<n-1;i+=2){
        // 从原来的一个中间变量变成了两个中间变量
        float mid_val p[i-1]a[i];
        p[i]mid_val;
        p[i+1]mid_val a[i+1];
	}
}
```

![CPE](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/13/image-20230613011144437-a82d2d.png)
