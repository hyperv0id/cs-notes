是一个**轻量级进程**。线程与同一进程的其他线程共享 code section, data section, heap, open files 以及 signals。

![img](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/16/2022-12-08-17-49-13-3e3b20.png)



![img](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/16/2022-12-08-17-49-36-a90c76.png)

> 对于支持线程的操作系统，实际调度的是内核级线程而非进程。也就是说，线程是运行以及 CPU 调度的基本单元。（而进程是分配资源的基本单元。）

## 优缺点



用户级线程的优点包括：

- 便宜：它并不实际占用操作系统的 TID (Thread ID) 等资源，因此理论上来说可以支持比内核级线程更多的线程数；
- 高效：它的调度等操作代码均在用户态，不需要进入内核态；
- DIY：比较容易实现自定义的调度算法。

用户级线程的缺点包括：

- 菜：一旦当前正在运行的线程阻塞，那么在操作系统看来就是整个进程被阻塞了，那么同一个进程中的其他线程也同样会被阻塞；而如果是内核级线程的话，一个线程阻塞了，其他线程仍然能正常运行。
- 多核：同一个进程中的多个用户级线程无法在多核上分别运行。
- 限制：32位机器上地址有限制，多线程会导致地址空间更加紧缩。

## 实现



<img src="https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/16/2022-12-08-17-54-35-dfbed3.png" alt="img" style="zoom:80%;" />

### 用户级

- 用户管理，不涉及CPU变态，开销少。
- 一个有难八方围观，并发度不高，不能在多核上并行。

### 内核级

OS管理，需要CPU切换。

- 多核并行执行，一个阻塞其他还能用，并发度高。
- 线程管理成本高，开销大。

### 组合实现

$n$个用户线程对于$m$和内核线程（$n>=m$）

## 线程状态



![image-20230616204445192](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/16/image-20230616204445192-38d3db.png)

## 组织与控制

![image-20230616204652301](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/16/image-20230616204652301-18e48c.png)