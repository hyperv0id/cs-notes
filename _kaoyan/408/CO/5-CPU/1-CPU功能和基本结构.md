## CPU功能

1. **指令控制**：取指令、分析指令、执行指令
2. **操作控制**：指令的执行细分成多个操作。每个操作对应操作信号，会将操作信号发给组件，如寄存器。
3. **时间控制**：操作的先后顺序。按时间顺序逐一发送信号
4. **数据加工**：数据的逻辑/算数控制
5. **中断处理**：对异常或特殊情况做处理

## CPU结构

![CPU结构](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/14/image-20230614203345328-00779f.png)

### 运算器

运算器功能：对数据加工

基本结构：

1. ALU：算术逻辑单元
2. 通用寄存器：都可能作为ALU的输入

![image-20230614201110569](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/14/image-20230614201110569-c1c8ed.png)

#### 专用数据通路方式

根据指令执行过程中的数据和地址的方向安排连接线路

特点：不存在数据冲突。但硬件复杂，实现难度大。

> 同时传输数据，如何判断要传输哪个？

解决办法：使用**多路选择器**或者**三态门**

<img src="https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/14/image-20230614201405927-0df5da.png" alt="专用数据通路模式图" style="zoom:40%;" /> <img src="https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/14/image-20230614201509372-fe2db4.png" alt="image-20230614201509372" style="zoom: 40%;" /><img src="https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/14/image-20230614201711185-4c7e32.png" alt="image-20230614201711185" style="zoom: 40%;" />

**三态门**：$R0_{out}$为1时$R0$的数据输出到A端，为0时$R0$无法输出到B端

#### CPU内部单总线

<img src="https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/14/image-20230614201911336-835472.png" alt="CPU内部单总线模式图" style="zoom:50%;" />

使用三态门控制输入/输出控制信号

特点：实现简单，但是存在冲突

当`Add R0, R1`时，数据同时送到总线上，采用暂存寄存器暂存。

新问题：ALU的输出立刻写回总线

![image-20230614202436070](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/14/image-20230614202436070-5831f2.png)



### 控制器

控制器功能：协调并控制计算机执行程序的指令序列：取、分析、执行

- 取指令：自动形成指令地址，即PC加一

- 分析指令：操作码译码、产生操作数的有效地址

- 执行指令：分成多个微操作，控制寄存器，控制IO等

- 中断处理：管理总线的输入输出，处理异常情况

### 控制器基本结构

1. 程序计数器PC：下一条指令的存放地址
2. 指令寄存器：当前正在执行的指令
3. 指令译码器：仅对操作字段译码，向控制器提供操作信号
4. 微操作信号发生器：根据译码结果安排操作次序
5. 时序系统：产生时序信号
6. 异常处理
7. 存储器地址寄存器MAR：要访问的主存单元的地址



![image-20230614203312212](https://pic-1257412153.cos.ap-nanjing.myqcloud.com/images/2023/06/14/image-20230614203312212-0f997e.png)

